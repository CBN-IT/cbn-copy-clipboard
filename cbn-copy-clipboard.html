<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="cbn-copy-clipboard-behavior.html">

<!--
`cbn-copy-clipboard`
custom polymer element that is copying text ti clipboard just by one click

@demo demo/index.html
-->

<dom-module id="cbn-copy-clipboard">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <slot id="slot"></slot>
    </template>

    <script>
        class CbnCopyClipboard extends CbnCopyClipboardBehavior(Polymer.Element) {
            static get is() {
                return 'cbn-copy-clipboard';
            }
            static get properties() {
                return {
                    value: {
                        type: String,
                        value: ""
                    }
                };
            }

            ready() {
                super.ready();
                this.addEventListener('click', e => this.copy(e));
            }
//
            /**
             * Function that copies the text to clipboard
             * source: http://stackoverflow.com/a/30810322/1016548
             * @param text {string} The string to be copied. Must call this function on a click event
             */
            copy() {
                //this function call must come from an event like click
                if (this.value != null && this.value != '') {
                    this.copyTextToClipboard(this.value);
                } else {
                    let c = '';
                    let distributedNodes = this.$.slot.assignedNodes({flatten: true});
                    for (let i = 0; i < distributedNodes.length; ++i) {
                        let el = distributedNodes[i];
                        if (el.nodeType == 3) {
                            c += el.nodeValue;
                        } else {
                            c += el.innerText;
                        }
                    }
                    this.copyTextToClipboard(c);
                }
            }
        }

        window.customElements.define(CbnCopyClipboard.is, CbnCopyClipboard);
    </script>
</dom-module>
